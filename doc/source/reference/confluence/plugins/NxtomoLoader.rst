NxtomoLoader
-----------------------------

.. raw:: html

    <!DOCTYPE html>
    <html>
        <head>
            <title>Tomography Reconstruction : NxtomoLoader</title>
            <link rel="stylesheet" href="styles/site.css" type="text/css" />
            <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
        </head>

        <body class="theme-default aui-theme-default">
            <div id="page">
                <div id="main" class="aui-page-panel">


                    <div id="content" class="view">
                        <div class="page-metadata">







                Created by <span class='author'> Kaz Wanelik</span>, last modified on Feb 22, 2020
                            </div>
                        <div id="main-content" class="wiki-content group">
                        <p><br/></p><p><style type='text/css'>/*<![CDATA[*/
    div.rbtoc1592231715325 {padding: 0px;}
    div.rbtoc1592231715325 ul {list-style: disc;margin-left: 0px;}
    div.rbtoc1592231715325 li {margin-left: 0px;padding-left: 0px;}
    .syntaxhighlighter-pre {font-size: small;}
    table {font-size: small;}
    /*]]>*/</style><div class='toc-macro rbtoc1592231715325'>
    <ul class='toc-indentation'>
    <li><a href='#NxtomoLoader-Summary'>Summary</a></li>
    <li><a href='#NxtomoLoader-Parameters'>Parameters</a>
    <ul class='toc-indentation'>
    <li><a href='#NxtomoLoader-Briefdescription'>Brief description</a></li>
    <li><a href='#NxtomoLoader-Additionalnotes'>Additional notes</a></li>
    </ul>
    </li>
    <li><a href='#NxtomoLoader-Usage'>Usage</a>
    <ul class='toc-indentation'>
    <li><a href='#NxtomoLoader-Howtoloaddark-andflat-fielddatafromindividualNeXusdatasets?'>How to load dark- and flat-field data from individual NeXus datasets?</a></li>
    </ul>
    </li>
    </ul>
    </div></p><h2 id="NxtomoLoader-Summary"><strong>Summary</strong></h2><p><strong><br/></strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 99.9448%;"><colgroup><col style="width: 4.35016%;"/><col style="width: 10.6754%;"/><col style="width: 10.5905%;"/><col style="width: 32.5202%;"/><col style="width: 12.4938%;"/><col style="width: 6.61306%;"/><col style="width: 22.7297%;"/></colgroup><tbody><tr><td class="highlight-green confluenceTd" colspan="7" data-highlight-colour="green" style="text-align: center;"><strong>NxtomoLoader</strong></td></tr><tr><th class="highlight-yellow confluenceTh" data-highlight-colour="yellow" style="text-align: center;">Process category</th><th class="highlight-yellow confluenceTh" colspan="1" data-highlight-colour="yellow" style="text-align: center;">Brief description</th><th class="highlight-yellow confluenceTh" colspan="1" data-highlight-colour="yellow"><p style="text-align: center;">Computational demand</p><p style="text-align: center;">for typical tomography data</p><p style="text-align: center;">(low, medium, high)</p></th><th class="highlight-yellow confluenceTh" colspan="1" data-highlight-colour="yellow" style="text-align: center;">Comment(s)</th><th class="highlight-yellow confluenceTh" colspan="1" data-highlight-colour="yellow" style="text-align: center;">Reference(s)</th><th class="highlight-yellow confluenceTh" colspan="1" data-highlight-colour="yellow" style="text-align: center;">Common alternative process(es)</th><th class="highlight-yellow confluenceTh" colspan="1" data-highlight-colour="yellow" style="text-align: center;">Known issues</th></tr><tr><td class="confluenceTd">loader</td><td colspan="1" class="confluenceTd">To specify the location of raw dataset(s) to be used as input.</td><td colspan="1" class="confluenceTd"><span style="color: rgb(0,128,0);">Low</span></td><td colspan="1" class="confluenceTd"><ol><li>Implements lazy loading, i.e. no data is actually loaded until the first genuine access request is made by a subsequent process in the process list (as usual, the initial loading times depend on data chunking of source dataset(s)).</li><li>Capable of handling the case of <em>dark</em>- and <em>flat-field</em> data being supplied in two individual NeXus datasets, one for the <em>dark-field</em> data and the other for the <em>flat-field</em> data (these two datasets are most often stored in two separate files, but it is also possible to have them stored as two separate datasets in a single file). No image-key information is required in this case to accompany either of the two datasets, and, if present (at the location specified by <em><strong>image_key_path</strong></em>), this information is ignored. This functionality can be used not only to reconstruct tomography data but also to process (e. g. dark-and-flat correct) radiography  data for which <em>darks, flats</em> and <em>projections</em> are typically provided in three separate files.</li><li>Does not handle the case of the <strong><em>NXtomo</em></strong> entry pointing to a set of paths to individual <strong>TIFF</strong> files (as opposed to a single HDF5 dataset). </li><li>Specifying the location of <em>dark</em>- and <em>flat-field</em> data in <strong>NxtomoLoader</strong> is <strong>not</strong> sufficient for the <em>dark</em>-and-<em>flat-field</em> correction to be applied (<a href="DarkFlatFieldCorrection_76392109.html"><strong>DarkFlatFieldCorrection</strong></a> needs to be explicitly included in every process list that seeks this correction).</li></ol></td><td colspan="1" class="confluenceTd"><ol><li><a class="external-link" href="http://download.nexusformat.org/doc/html/classes/applications/NXtomo.html#nxtomo" rel="nofollow">NeXus NXtomo application definition</a></li><li><a class="external-link" href="http://www.nexusformat.org" rel="nofollow">NeXus file format</a></li><li><a class="external-link" href="https://support.hdfgroup.org/HDF5/" rel="nofollow">HDF5 data model &amp; file format</a><br/><br/></li></ol></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><div class="content-wrapper"><ol><li>Currently, <strong>NxtomoLoader</strong> can only handle either the<em> case </em>of both<em> dark</em>- and <em>flat-field</em> data being supplied in the same (combined) dataset as <em>sample projections</em> or that of both being provided in two separate external datasets, one containing only <em>darks</em> and the other only <em>flats. </em>For instance, <strong>NxtomoLoader</strong> will currently fail if <em>darks </em>are supplied together with <em>sample projections</em>, whereas <em>flats </em> are provided in a separate external dataset:
    <span class="jira-issue" data-jira-key="SCI-6814" >
                        <a href="https://jira.diamond.ac.uk/browse/SCI-6814?src=confmacro" class="jira-issue-key"><img class="icon"
                                                                                          src="https://jira.diamond.ac.uk/secure/viewavatar?size=xsmall&amp;avatarId=13033&amp;avatarType=issuetype"/>SCI-6814</a>
                                -
                <span class="summary">Allow a separate dark OR flat in the nxtomo_loader</span>
                                                    <span class="aui-lozenge aui-lozenge-subtle             aui-lozenge-current
         jira-macro-single-issue-export-pdf">In Progress</span>
                    </span>
        <em> </em></li></ol><p><br/></p></div></td></tr></tbody></table></div><p><br/></p><h2 id="NxtomoLoader-Parameters"><strong>Parameters</strong></h2><p><strong><br/></strong></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/></colgroup><tbody><tr><th class="highlight-green confluenceTh" data-highlight-colour="green"><h3 id="NxtomoLoader-Briefdescription">Brief description</h3></th></tr></tbody></table></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Savu Configurator command</b></div><div class="codeContent panelContent pdl">
    <pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&gt;&gt;&gt; disp -avv

    -------------------------------------------------------------------------------------
     1) NxtomoLoader(savu.plugins.loaders.full_field_loaders.nxtomo_loader)
      A class for loading standard tomography data in Nexus format.
        1)                preview : []
        A slice list of required frames.
        2)         image_key_path : entry1/tomo_entry/instrument/detector/image_key
        Path to the image key entry inside the nxs file.
        3)                   name : tomo
        The name assigned to the dataset.
        4)               3d_to_4d : False
        Set to true if this reshape is required.
        5)                   flat : [None, None, 1]
        Optional Path to the flat field data file, nxs path and scale value.
        6)              data_path : entry1/tomo_entry/data/data
        Path to the data inside the file.
        7)                   dark : [None, None, 1]
        Optional path to the dark field data file, nxs path and scale value.
        8)                 angles : None
        A python statement to be evaluated or a file.
        9)           ignore_flats : None
        List of batch numbers of flats (start at 1) to ignore.
    -------------------------------------------------------------------------------------

    &gt;&gt;&gt;</pre>
    </div></div><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/></colgroup><tbody><tr><th class="highlight-green confluenceTh" data-highlight-colour="green"><h3 id="NxtomoLoader-Additionalnotes">Additional notes</h3></th></tr></tbody></table></div><p>For basic information on this process, please use the <em><strong>disp -av </strong></em>(or <em><strong>disp -avv </strong></em>or <em><strong>disp</strong></em><strong> </strong><strong>-v</strong>[<strong>v</strong>] <strong>&lt;</strong><em>process index</em><strong>&gt;</strong>) command in <strong>Savu Configurator </strong>(see above). The table below is intended to provide some additional notes on a number of selected topics:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 99.9452%;"><colgroup><col style="width: 3.17974%;"/><col style="width: 6.91168%;"/><col style="width: 15.8795%;"/><col style="width: 15.2752%;"/><col style="width: 27.1348%;"/><col style="width: 31.6191%;"/></colgroup><tbody><tr><th class="highlight-yellow confluenceTh" data-highlight-colour="yellow" rowspan="2" style="text-align: center;">Item</th><th class="highlight-yellow confluenceTh" data-highlight-colour="yellow" rowspan="2" style="text-align: center;">Parameter name</th><th class="highlight-yellow confluenceTh" data-highlight-colour="yellow" rowspan="2" style="text-align: center;">Parameter format</th><th class="highlight-yellow confluenceTh" colspan="2" data-highlight-colour="yellow" style="text-align: center;">Example(s)</th><th class="highlight-yellow confluenceTh" data-highlight-colour="yellow" rowspan="2" style="text-align: center;">Comment(s)</th></tr><tr><th class="highlight-yellow confluenceTh" colspan="1" data-highlight-colour="yellow" style="text-align: center;">Parameter value</th><th class="highlight-yellow confluenceTh" colspan="1" data-highlight-colour="yellow" style="text-align: center;">Effect</th></tr><tr><td rowspan="9" class="confluenceTd">1</td><td rowspan="9" class="confluenceTd"><em>preview</em></td><td rowspan="9" class="confluenceTd">[<em><span style="color: rgb(255,102,0);">ind_0</span>, <span style="color: rgb(51,102,255);"><span style="color: rgb(255,102,0);">ind_1</span></span>,... <span style="color: rgb(255,102,0);">ind_(n-1)</span></em>]<br/><br/><br/></td><td colspan="1" class="confluenceTd">[ ] (default)</td><td colspan="1" class="confluenceTd"><span style="color: rgb(0,0,0);">T</span>o select the entire <span style="color: rgb(128,0,0);">n</span>-dimensional dataset of <em>sample projections</em>, stored at location specified by the <strong><em>data_path</em> </strong>parameter and accompanied by the image-key data supplied via the <strong><em>image_key_path</em></strong> parameter.</td><td colspan="1" class="confluenceTd"><ol><li>The <strong><em>preview</em></strong> parameter provides a convenient mechanism for restricting the entire dataset to a desired subset.</li><li>The default value of the <strong><em>preview</em></strong> parameter, [ ] (empty Python list), represents the <strong>entire</strong> dataset.<strong> <br/></strong></li></ol></td></tr><tr><td colspan="1" class="confluenceTd">[:, :, :]</td><td colspan="1" class="confluenceTd">To select the entire 3d dataset of <em>sample projections</em>, stored at location specified by the <strong><em>data_path</em></strong> parameter and accompanied by the image-key data supplied via the <strong><em>image_key_path</em></strong> parameter.</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">[:, <span style="color: rgb(128,0,0);">s</span>, :] </td><td colspan="1" class="confluenceTd">To select from a given 3d dataset of <em>sample projections</em> (stored at the <strong><em>data_path </em></strong>location with the corresponding image keys at the <strong><em>image_key_path</em></strong> location) only a subset of data corresponding to the <span style="color: rgb(128,0,0);">s</span>-th <em>sinogram.</em></td><td colspan="1" class="confluenceTd">This particular interpretation applies if data are laid out in the (<span style="color: rgb(255,102,0);"><em>angle_enumeration</em></span>, <span style="color: rgb(255,102,0);"><em>image_height</em></span>, <span style="color: rgb(255,102,0);"><em>image_width</em></span>) format.</td></tr><tr><td colspan="1" class="confluenceTd">[<span style="color: rgb(128,0,0);">p</span>, :, :]</td><td colspan="1" class="confluenceTd">To select from a given 3d dataset of <em>sample projections</em> (stored at <strong><em>data_path</em></strong> location with the corresponding image keys at the <strong><em>image_key_path</em></strong> location) only a subset of data corresponding to the <span style="color: rgb(128,0,0);">p</span>-th <em>sample projection.</em></td><td colspan="1" class="confluenceTd">This particular interpretation applies if data are laid out in the (<span style="color: rgb(255,102,0);"><em>angle_enumeration</em></span>, <span style="color: rgb(255,102,0);"><em>image_height</em></span>, <span style="color: rgb(255,102,0);"><em>image_width</em></span>) format.</td></tr><tr><td colspan="1" class="confluenceTd">[:, :, <span style="color: rgb(128,0,0);">12</span>:<span style="color: rgb(128,0,0);">-34</span>]</td><td colspan="1" class="confluenceTd">To select from a given 3d dataset of <em>sample projections</em> (stored at the <strong><em>data_path </em></strong>location with the corresponding image keys at the <strong><em>image_key_path</em></strong> location) only a subset of data generated by cropping the width of each <em>sample projection</em> by <span style="color: rgb(128,0,0);">12</span> pixels from the left-hand side and <span style="color: rgb(128,0,0);">34 </span>pixels from the right-hand side.</td><td colspan="1" class="confluenceTd">This particular interpretation applies if data are laid out in the (<span style="color: rgb(255,102,0);"><em>angle_enumeration</em></span>, <span style="color: rgb(255,102,0);"><em>image_height</em></span>, <span style="color: rgb(255,102,0);"><em>image_width</em></span>) format.</td></tr><tr><td colspan="1" class="confluenceTd">[:, <span style="color: rgb(0,0,0);"><em>mid</em> - <span style="color: rgb(128,0,0);">1</span>:<em>mid</em> + <span style="color: rgb(128,0,0);">1</span></span>, :]</td><td colspan="1" class="confluenceTd">To select from a given 3d dataset of <em>sample projections</em> (stored at the <strong><em>data_path </em></strong>location with the corresponding image keys at the <strong><em>image_key_path</em></strong> location) only a subset of data corresponding to the middle <span style="color: rgb(128,0,0);">2</span> <em>sinograms.</em></td><td colspan="1" class="confluenceTd"><em>mid</em> is one of <strong>Savu</strong> keywords (with an obvious meaning).</td></tr><tr><td colspan="1" class="confluenceTd"><p>[0:<em>end</em>:2<em>, </em><span style="color: rgb(0,0,0);">:</span>, :]</p><p>[::2<em>, </em><span style="color: rgb(0,0,0);">:</span>, :]</p></td><td colspan="1" class="confluenceTd">To select from a given 3d dataset of <em>sample projections</em> (stored at the <strong><em>data_path </em></strong>location with the corresponding image keys at the <strong><em>image_key_path</em></strong> location) only a subset of data corresponding to every other <em>sample projection.</em></td><td colspan="1" class="confluenceTd"><em>end</em> is one of <strong>Savu</strong> keywords (with an obvious meaning).</td></tr><tr><td colspan="1" class="confluenceTd"><p>[0:<em>end</em>:<em>end, </em><span style="color: rgb(0,0,0);">:</span>, :]</p><p>[::<em>end, </em><span style="color: rgb(0,0,0);">:, :</span>]</p></td><td colspan="1" class="confluenceTd">To select from a given 3d dataset of <em>sample projections</em> (stored at the <strong><em>data_path </em></strong>location with the corresponding image keys at the <strong><em>image_key_path</em></strong> location) only the first and the last <em>sample projection.</em></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd"><p>[:, 0:<em>end</em>:2<em>, </em><span style="color: rgb(0,0,0);">:</span>]</p><p>[:, ::2<em>, </em><span style="color: rgb(0,0,0);">:</span>]</p></td><td colspan="1" class="confluenceTd">To select from a given 3d dataset of <em>sample projections</em> (stored at the <strong><em>data_path </em></strong>location with the corresponding image keys at the <strong><em>image_key_path</em></strong> location) only a subset of data corresponding to every other <em>sinogram.</em></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">2</td><td class="confluenceTd"><p><em>image_key_path</em></p></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/instrument/detector/image_key</span> (default)</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><ol><li><strong>Mandatory</strong> dataset if dark- and flat-field images are provided in the same image dataset as sample projections. If dark- and flat-field images are <strong>not</strong> stored in the same dataset as sample projections, then this <strong><em>image_key_path</em></strong> parameter is ignored and can be set to <em>None. </em></li><li><p>The values of image keys are expected to adhere to the following convention: <strong>2</strong> for <em>dark-field</em> image; <strong>1</strong> for <em>flat-field</em> image; <strong>0</strong> for <em>sample projection</em>.</p></li></ol></td></tr><tr><td rowspan="2" class="confluenceTd">3</td><td rowspan="2" class="confluenceTd"><p><em>name</em></p></td><td rowspan="2" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">&lt;<span style="color: rgb(255,102,0);"><em>any-string-of-characters</em></span>&gt;</td><td colspan="1" class="confluenceTd">To label the loaded image dataset with a meaningful name, provided by the user ('<span style="color: rgb(153,51,0);">tomo</span>' by default). If desired, this name can then be used to refer to this dataset in the <strong>in_datasets</strong> parameter of any subsequent processes in a given process list. If no name is supplied in these subsequent <strong>in_datasets </strong>by the user, then <em><strong>Savu</strong></em> automatically propagates the <strong>name</strong> from NxtomoLoader as appropriate). For example, if the <strong><em>name</em></strong> parameter were to be genuinely set to '<span style="color: rgb(255,102,0);"><em>any-string</em></span><span style="color: rgb(255,102,0);"><em>-of-characters</em></span>', then the reconstructed volume would have been found at /entry/final_result_<span style="color: rgb(255,102,0);"><em>any-string</em></span><span style="color: rgb(255,102,0);"><em>-of-characters</em></span>/data in the top-level output file, named <span style="color: rgb(255,102,0);"><em>scan-number</em></span>_processed.nxs, and, if present, <strong>TiffSaver</strong> would have saved the output TIFF images in a directory called 'TiffSaver-<span style="color: rgb(255,102,0);"><em>any-string<span style="color: rgb(255,102,0);"><em>-of-characters</em></span></em></span>'.</td><td rowspan="2" class="confluenceTd"><br/><br/></td></tr><tr><td colspan="1" class="confluenceTd"><span style="color: rgb(255,102,0);"><em>radiography</em></span></td><td colspan="1" class="confluenceTd">This is an example of a string that may be more appropriate than '<span style="color: rgb(153,51,0);">tomo</span>' for naming an image dataset collected, for example, at a single angle (as opposed to a series of angles over the range of 180 deg, used in tomography). </td></tr><tr><td rowspan="2" class="confluenceTd">4</td><td rowspan="2" class="confluenceTd"><p><em>3d_to_4d</em></p></td><td rowspan="2" class="confluenceTd"><em>False</em> (default) or positive integer<br/><br/></td><td colspan="1" class="confluenceTd"><em>False</em> (default)</td><td colspan="1" class="confluenceTd"><p>To load a single 3d tomography dataset, interpreting the latter as a 3d array of shape (Z, img_L, img_W).</p></td><td rowspan="2" class="confluenceTd"><br/><br/></td></tr><tr><td colspan="1" class="confluenceTd">Positive integer Z<sub>cmn</sub>, indicating the total (common) number of images in each tomography dataset in a multi-tomography dataset to be loaded</td><td colspan="1" class="confluenceTd"><p>To load a series of identical tomography datasets (each comprising exactly Z<sub>cmn</sub> images) from a single, 3d multi-tomography dataset, interpreting the latter as a 4d array whose shape is derived as follows:</p><p>(Z, img_L, img_W) → (Z<sub>cmn</sub>, img_L, img_W, Z/Z<sub>cmn</sub>)</p></td></tr><tr><td colspan="1" class="confluenceTd">5</td><td colspan="1" class="confluenceTd"><p><em>flat</em></p></td><td colspan="1" class="confluenceTd"><p>[&lt;<span style="color: rgb(255,102,0);"><em>path-to-NeXus-file</em></span>&gt;, &lt;<span style="color: rgb(255,102,0);"><em>path-to-dataset</em></span>&gt;, <em>&lt;<span style="color: rgb(255,102,0);">exposure-time-compensation-factor</span></em>&gt;]</p><p>where</p><p>&lt;<em><span style="color: rgb(255,102,0);">exposure-time-compensation-factor</span></em>&gt; = &lt;<em><span style="color: rgb(255,102,0);">sample-exposure-time<span style="color: rgb(0,0,0);">&gt;/&lt;<span style="color: rgb(255,102,0);">flat-exposure-time</span>&gt;</span></span></em></p></td><td colspan="1" class="confluenceTd">[<span style="color: rgb(128,0,0);">/dls/i13/data/2018/cm123-4/raw/5678.nxs</span>, <span style="color: rgb(128,0,0);">entry1/instrument/detector/pco1/data</span>, <span style="color: rgb(128,0,0);">1.25</span>]</td><td colspan="1" class="confluenceTd">To select all <em>flat-field </em>images from the <em>flats</em>-only dataset located at <span style="color: rgb(128,0,0);">entry1/instrument/detector/pco1/data</span> inside a NeXus scan file, stored on the file system at <span style="color: rgb(128,0,0);">/dls/i13/data/2018/cm123-4/raw/5678.nxs</span>, and then to multiply their pixel values by <span style="color: rgb(128,0,0);">1.25</span> (to compensate for the <em>flat-field</em> exposure interval being <span style="color: rgb(128,0,0);">0.8</span> times shorter than the <em>sample-projection</em> exposure time).</td><td colspan="1" class="confluenceTd"><ol><li>This parameter needs to be specified <strong>only</strong> if <em><em>flats</em> </em>are <strong>not</strong> stored in the same dataset as <em>sample projections</em>.</li><li>If &lt;<span style="color: rgb(255,102,0);"><em>path-to-NeXus-file</em></span>&gt; points to an accessible NeXus file, then <em>flats</em> are loaded from a dataset found at &lt;<span style="color: rgb(255,102,0);"><em>path-to-dataset</em></span>&gt; inside that file, and their pixel values are then multiplied by <em>&lt;<span style="color: rgb(255,102,0);">exposure-time-compensation-factor</span></em>&gt;.</li><li>The dataset at &lt;<span style="color: rgb(255,102,0);"><em><span style="color: rgb(255,102,0);"><em>path-to-dataset</em></span></em></span>&gt; must contain <strong>only</strong> <em>flats. </em>These external <em>flats</em> override any internal <em>flats</em> that may be stored alongside <em>sample projections</em> in the principal raw-data NeXus scan file. When overriding internal <em>flats,</em> it is usually necessary to use the <strong><em>angles</em> </strong>parameter (see below) to specify only the angles at which <em>sample projections</em> were collected (otherwise there will be a mismatch between the length the image dataset (stored by default in <span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/data/data</span>) and that of the angle dataset (stored by default in <span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/data/rotation_angle<span style="color: rgb(0,0,0);">)</span></span>.</li><li>No image-key information is required to accompany the <em><em>flat</em></em> dataset, and, if present (at the location specified by <em><strong>image_key_path</strong></em>), this information is ignored.</li><li>Note that, if the<em> flat-field</em> dataset is integer-valued, then the multiplication by <em>&lt;<span style="color: rgb(255,102,0);">exposure-time-compensation-factor</span></em>&gt; (even if the latter is provided in the form of the integer value of 1, as opposed to the floating-point value of 1.0) changes this data type to the floating-point type, which in turn may be unsuitable as input for the immediately succeeding process, e.g. <a href="Dezinger_76392334.html"><strong>Dezinger</strong></a> (use <a href="DezingerSinogram_83739364.html"><strong>DezingerSinogram</strong></a> instead)<strong>.</strong></li></ol></td></tr><tr><td colspan="1" class="confluenceTd">6</td><td colspan="1" class="confluenceTd"><p><em>data_path</em></p></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/data/rotation_angle</span> (default)</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><strong>Mandatory</strong> dataset.</td></tr><tr><td colspan="1" class="confluenceTd">7</td><td colspan="1" class="confluenceTd"><p><em>dark</em></p></td><td colspan="1" class="confluenceTd"><p>[&lt;<span style="color: rgb(255,102,0);"><em>path-to-NeXus-file</em></span>&gt;, &lt;<span style="color: rgb(255,102,0);"><em>path-to-dataset</em></span>&gt;, <em>&lt;<span style="color: rgb(255,102,0);">exposure-time-compensation-factor</span></em>&gt;]</p><p>where</p><p>&lt;<em><span style="color: rgb(255,102,0);">exposure-time-compensation-factor</span></em>&gt; = &lt;<em><span style="color: rgb(255,102,0);">sample-exposure-time<span style="color: rgb(0,0,0);">&gt;/&lt;<span style="color: rgb(255,102,0);">dark-exposure-time</span>&gt; </span></span></em></p><p><br/></p></td><td colspan="1" class="confluenceTd">[<span style="color: rgb(128,0,0);">/dls/i13/data/2018/cm123-4/raw/8765.nxs</span>, <span style="color: rgb(128,0,0);">entry1/instrument/detector/pco1/data</span>, <span style="color: rgb(128,0,0);">1</span>]</td><td colspan="1" class="confluenceTd">To select all <em>dark-field </em>images from the <em>darks</em>-only dataset located at <span style="color: rgb(128,0,0);">entry1/instrument/detector/pco1/data</span> inside a NeXus scan file, stored on the file system at <span style="color: rgb(128,0,0);">/dls/i13/data/2018/cm123-4/raw/8765.nxs</span>, and then to multiply their pixel values by <span style="color: rgb(128,0,0);">1</span> (this trivial multiplication factor should be used whenever the <em>dark-field</em> exposure interval is the same as the <em>sample-projection</em> exposure interval, in which case no change to recorded intensities is, of course, necessary).</td><td colspan="1" class="confluenceTd"><ol><li>This parameter needs to specified <strong>only</strong> if <em>darks </em>are <strong>not</strong> stored in the same dataset as <em>sample projections</em>.</li><li>If &lt;<span style="color: rgb(255,102,0);"><em>path-to-NeXus-file</em></span>&gt; points to an accessible NeXus file, then <em>flats</em> are loaded from a dataset found at &lt;<span style="color: rgb(255,102,0);"><em>path-to-dataset</em></span>&gt; inside that file, and their pixel values are then multiplied by <em>&lt;<span style="color: rgb(255,102,0);">exposure-time-compensation-factor</span></em>&gt;.</li><li>The dataset at &lt;<span style="color: rgb(255,102,0);"><em>path-to-dataset</em></span>&gt; must contain <strong>only</strong> <em>darks. </em>These external <em>darks</em> override any internal <em>darks</em> that may be stored alongside <em>sample projections</em> in the principal raw-data NeXus scan file. When overriding internal <em>darks,</em> it is usually necessary to use the <strong><em>angles</em> </strong>parameter (see below) to specify only the angles at which <em>sample projections</em> were collected (otherwise Savu will throw an error, reporting a mismatch between the length of the image dataset (stored by default in <span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/data/data</span>) and that of the angle dataset (stored by default in <span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/data/rotation_angle<span style="color: rgb(0,0,0);">)</span></span>.</li><li>No image-key information is required to accompany the <em><em>dark</em></em> dataset, and, if present (at the location specified by <em><strong>image_key_path</strong></em>), this information is ignored.</li><li>Note that, if the<em> dark-field</em> dataset is integer-valued, then the multiplication by <em>&lt;<span style="color: rgb(255,102,0);">exposure-time-compensation-factor</span></em>&gt; (even if the latter is provided in the form of the integer value of 1, as opposed to the floating-point value of 1.0) changes this data type to the floating-point type, which in turn may be unsuitable as input for the immediately succeeding process, e.g. <a href="Dezinger_76392334.html"><strong>Dezinger</strong></a> (use <a href="DezingerSinogram_83739364.html"><strong>DezingerSinogram</strong></a> instead)<strong>.</strong></li></ol></td></tr><tr><td rowspan="3" class="confluenceTd">8</td><td rowspan="3" class="confluenceTd"><p><em>angles</em></p></td><td rowspan="3" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><em>None </em>(Python keyword)</td><td colspan="1" class="confluenceTd">If the <strong><em>angles</em></strong> parameter is set to <em>None,</em> then this loader attempts to access values in a default dataset, located at <span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/data/rotation_angle</span> in the input NeXus scan file.</td><td class="confluenceTd"><br/><br/></td></tr><tr><td colspan="1" class="confluenceTd">np.linspace(<span style="color: rgb(153,51,0);">0</span>,<span style="color: rgb(153,51,0);">180</span>,<span style="color: rgb(153,51,0);">1801</span>)</td><td colspan="1" class="confluenceTd"><div class="content-wrapper"><p>To generate the following sequence of <span style="color: rgb(153,51,0);">1801</span> equidistant angles starting at <span style="color: rgb(153,51,0);">0.0</span> <span style="color: rgb(153,51,0);">deg</span> and ending at <span style="color: rgb(153,51,0);">180.0</span> <span style="color: rgb(153,51,0);">deg</span>:</p><p>array([  <span style="color: rgb(153,51,0);">0.00000000e+00</span>,   <span style="color: rgb(153,51,0);">1.00000000e-01</span>,   <span style="color: rgb(153,51,0);">2.00000000e-01</span>, ...,</p><p>         <span style="color: rgb(153,51,0);">1.79800000e+02</span>,   <span style="color: rgb(153,51,0);">1.79900000e+02</span>,   <span style="color: rgb(153,51,0);">1.80000000e+02</span>])</p></div></td><td class="confluenceTd"><div class="content-wrapper"><ol><li>'np' stands for numpy: <a class="external-link" href="https://numpy.org/" rel="nofollow">https://numpy.org/</a>.</li><li>For more details on linspace, see <a class="external-link" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.linspace.html" rel="nofollow">https://docs.scipy.org/doc/numpy/reference/generated/numpy.linspace.html</a>.</li></ol></div></td></tr><tr><td colspan="1" class="confluenceTd">np.linspace(<span style="color: rgb(153,51,0);">0</span>,<span style="color: rgb(153,51,0);">180</span>,<span style="color: rgb(153,51,0);">1801</span>)+<span style="color: rgb(153,51,0);">90</span></td><td colspan="1" class="confluenceTd"><p>To shift the np.linspace(<span style="color: rgb(153,51,0);">0</span>,<span style="color: rgb(153,51,0);">180</span>,<span style="color: rgb(153,51,0);">1801</span>) sequence by <span style="color: rgb(153,51,0);">90.0 </span>deg in order to generate the following sequence of <span style="color: rgb(153,51,0);">1801</span> equidistant angles starting at <span style="color: rgb(153,51,0);">90.0</span> deg and ending at <span style="color: rgb(153,51,0);">270.0</span> deg:</p><p>array([ <span style="color: rgb(153,51,0);">90.</span> , <span style="color: rgb(153,51,0);">90.1</span>, <span style="color: rgb(153,51,0);">90.2</span>, ..., <span style="color: rgb(153,51,0);">269.8</span>, <span style="color: rgb(153,51,0);">269.9</span>, <span style="color: rgb(153,51,0);">270.</span> ])</p></td><td colspan="1" class="confluenceTd">This shift by <span style="color: rgb(153,51,0);">90.0 </span>deg rotates reconstructed slices by <span style="color: rgb(153,51,0);">90.0 </span>deg.</td></tr><tr><td colspan="1" class="confluenceTd">9</td><td colspan="1" class="confluenceTd"><p><em>ignore_flats</em></p></td><td colspan="1" class="confluenceTd">[<em><span style="color: rgb(255,102,0);">ind_1</span>, <span style="color: rgb(255,102,0);">ind_2</span>,... <span style="color: rgb(255,102,0);">ind_m</span></em>]</td><td colspan="1" class="confluenceTd">[<span style="color: rgb(128,0,0);">1</span>, <span style="color: rgb(128,0,0);">r</span>]</td><td colspan="1" class="confluenceTd">To ignore the <span style="color: rgb(128,0,0);">initial</span> and the <span style="color: rgb(128,0,0);">r</span>-th batch in a given series of batches of <em>flats</em> (each containing however many individual <em>flat-field</em> images), stored in the same dataset as <em>darks</em> and <em>sample projections</em>.</td><td colspan="1" class="confluenceTd"><ol><li>Useful for excluding compromised <em>flats</em> in combined datasets containing multiple batches of interspaced <em>flats.</em></li><li>In the <em><strong>ignore_flats</strong></em> list, batch indexing starts from 1 (not 0).</li></ol></td></tr></tbody></table></div><p><br/></p><h2 id="NxtomoLoader-Usage"><strong>Usage<br/></strong></h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/></colgroup><tbody><tr><th class="highlight-green confluenceTh" data-highlight-colour="green"><h3 id="NxtomoLoader-Howtoloaddark-andflat-fielddatafromindividualNeXusdatasets?">How to load dark- and flat-field data from individual NeXus datasets?</h3></th></tr></tbody></table></div><p>Any standard tomography NeXus scan file, generated by GDA, stores all the recorded images (i.e. <em>sample projections</em> as well as <em>dark</em>- and <em>flat-field</em> images) in a single 3-dimensional dataset located at <span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/data/data</span>. This combined image dataset is always accompanied by another important dataset which contains the corresponding image-key information, located in the same file at <span style="color: rgb(128,0,0);">entry1/<strong>tomo_entry</strong>/instrument/detector/image_key</span>. For obvious reasons, the default values of <span style="color: rgb(0,0,0);"><strong>NxtomoLoader</strong>'s parameters have been selected to reflect this standard scenario. If necessary, however, <strong><span style="color: rgb(0,0,0);">NxtomoLoader</span></strong> </span>can also be used to load <em>dark</em>- and <em>flat-field</em> data from two separate NeXus datasets, one containing only <em>darks</em> and the other only <em>flats</em> (these two datasets can be provided in the same NeXus file or in two separate NeXus files, one for <em>darks</em> and the other for <em>flats</em>)<em>.</em> This non-standard scenario can be handled by making appropriate modifications to the default settings of the <strong><em>flat</em></strong> and <strong><em>dark</em></strong> parameters (see the table above for more details).</p><p><br/></p><p><br/></p><p><strong><br/></strong></p><p><strong><br/></strong></p>
                        </div>



                    </div>             </div>
                <div id="footer" role="contentinfo">
                    <section class="footer-body">
                        <p>Document generated by Confluence on Jun 15, 2020 15:35</p>
                        <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                    </section>
                </div>
            </div>     </body>
    </html>
